# VprokParser

Два простых скрипта для парсинга vprok.ru:
- UI-парсер (Puppeteer) для страницы конкретного товара с установкой региона.
- API-парсер (через встраиваемые данные страницы) для списка товаров в категории.

Оба скрипта написаны на Node.js и используют Puppeteer. Скрипты не обходят пагинацию и работают только со страницей, которую вы передаёте в командной строке.

## Требования
- Node.js 18+ (рекомендуется LTS)
- Интернет-соединение
- Система, поддерживающая запуск Chromium от Puppeteer (Puppeteer сам загрузит нужный браузер при установке)

## Установка
1. Склонируйте репозиторий или скопируйте файлы проекта.
2. Установите зависимости:
   - npm: `npm install`
   - или yarn: `yarn install`

## Скрипт 1: UI‑парсер (страница товара)
Файл: `ui-parser.js`

Назначение: открывает страницу товара, пытается установить заданный регион, делает скриншот и извлекает основные данные о цене/рейтинге/отзывах.

Выходные файлы:
- `screenshot.jpg` — полноэкранный скриншот страницы товара.
- `product.txt` — текстовый файл с краткими данными:
  - Цена
  - Старая цена
  - Рейтинг
  - Количество отзывов

Запуск напрямую:
- Формат: `node ui-parser.js <product_url> <region>`
- Пример:
  ```bash
  node ui-parser.js https://www.vprok.ru/product/domik-v-derevne-dom-v-der-moloko-ster-3-2-950g--309202 "Санкт-Петербург и область"
  ```

Запуск через npm/yarn-скрипты:
- npm: `npm run parse -- <product_url> "<region>"`
- yarn: `yarn parse <product_url> "<region>"`

Примечания по региону:
- Регион должен быть указан строкой так, как он отображается на сайте. Примеры: `"Москва и область"`, `"Санкт-Петербург и область"`.
- Скрипт пытается кликнуть по нужному региону в выпадающем списке. Если нужный регион не найден/не кликнулся, в `product.txt` цены могут быть «не определена» (товар может отсутствовать в выбранном регионе).

Что извлекается:
- Цена (текущая/акционная)
- Старая цена (до акции), если доступна
- Рейтинг
- Количество отзывов

Технические детали:
- Запускается Chromium с видимым окном (headless: false) и размером 1366×900.
- Язык браузера принудительно `ru-RU`.
- Перед извлечением данных скрипт делает установку региона и затем скриншот.

## Скрипт 2: API‑парсер (категория)
Файл: `api-parser.js`

Назначение: открывает страницу категории, извлекает данные о товарах первой страницы из встраиваемого блока `__NEXT_DATA__` и сохраняет их в JSON.

Выходной файл:
- `products_api.txt` — JSON-массив с объектами следующего вида (ключи на русском):
  - `Название товара`
  - `Cсылка на страницу товара`
  - `Рейтинг`
  - `Количество отзывов`
  - `Цена`
  - `Акционная цена`
  - `Цена до акции`
  - `Размер скидки`

Важно: обрабатывается только первая страница категории, пагинация не реализована.

Запуск напрямую:
- Формат: `node api-parser.js <category_url>`
- Пример:
  ```bash
  node api-parser.js https://www.vprok.ru/catalog/7382/pomidory-i-ovoschnye-nabory
  ```

Запуск через npm/yarn-скрипты:
- npm: `npm run api -- <category_url>`
- yarn: `yarn api <category_url>`

Технические детали:
- Ожидается успешная загрузка страницы (HTTP 200) и наличие тега `<script id="__NEXT_DATA__" type="application/json">` в HTML.
- Данные берутся из `props.pageProps.initialStore.catalogPage.products`.
- Браузер запускается в видимом режиме (`headless: false`) и ждёт `networkidle2` при переходе по URL.

## Примеры выходных данных
`product.txt` (UI‑парсер):
```
Цена: 129.99
Старая цена: 159.99
Рейтинг: 4.1
Количество отзывов: 1989
```

`products_api.txt` (API‑парсер, JSON):
```json
[
  {
    "Название товара": "Помидоры розовые",
    "Cсылка на страницу товара": "https://www.vprok.ru/product/...",
    "Рейтинг": 4.6,
    "Количество отзывов": 123,
    "Цена": 199.99,
    "Акционная цена": 169.99,
    "Цена до акции": 199.99,
    "Размер скидки": 30
  }
]
```

## Советы и устранение неполадок
- Регион не устанавливается (UI‑парсер):
  - Убедитесь, что строка региона совпадает с вариантом на сайте.
  - Иногда элементы могут загружаться с задержкой — попробуйте ещё раз или запустите с хорошим интернетом.
  - Цена может быть «не определена» при отсутствии товара в выбранном регионе — это нормальное поведение.
- Антибот‑механизмы: слишком частые запросы/скроллы/запуски могут привести к защите. Увеличьте задержки между запуском скриптов.
- Headless‑режим: по умолчанию оба скрипта запускают браузер в видимом режиме. Если знаете, что делаете, можете поменять `headless` на `true` в коде, но это может влиять на поведение сайта.
- Права доступа к файлам: убедитесь, что у процесса есть права на запись в каталог проекта (создаются `product.txt`, `screenshot.jpg`, `products_api.txt`).

## Скрипты npm
В `package.json` настроены команды:
- `npm run parse -- <product_url> "<region>"` — UI‑парсер
- `npm run api -- <category_url>` — API‑парсер


## Статический анализ кода: ESLint и Prettier
В проект добавлены линтер (ESLint) и форматтер (Prettier) с интеграцией друг с другом.

### Установка (dev-зависимости)
Если уже установлены обычные зависимости, добавьте dev-зависимости:
- npm: `npm install --save-dev eslint eslint-config-prettier eslint-plugin-prettier prettier`
- или yarn: `yarn add -D eslint eslint-config-prettier eslint-plugin-prettier prettier`

### Конфигурация
- `.eslintrc.json` — базовые правила для Node/CommonJS, включены `eslint:recommended` и интеграция с Prettier.
- `.eslintignore` — исключает node_modules и артефакты (изображения, lock-файлы, экспортируемые txt).
- `.prettierrc` — стилистика кода (одинарные кавычки, trailing commas, ширина строки 100 и т.д.).
- `.prettierignore` — те же исключения, что и у ESLint.

### Скрипты npm
В `package.json` добавлены команды:
- `npm run lint` — запустить ESLint на всём проекте
- `npm run lint:fix` — ESLint с автоматическим исправлением
- `npm run format` — применить Prettier ко всем файлам
- `npm run format:check` — проверить форматирование без изменений

Совет: сначала запускайте `lint:fix`, затем `format`.
